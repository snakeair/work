import{_ as t,c as e,o as s,d as a,i,j as n,r as o,a as h,b as r,y as l,l as c,m as u,w as v,e as d,p as g,f}from"../default/default-5704fa67.js";import{$ as p}from"./upload-9b261bfb.js";var m=t({props:{width:{type:Number,default:800},height:{type:Number,default:300},lineWidth:{type:Number,default:4},lineColor:{type:String,default:"#000000"},bgColor:{type:String,default:""},isCrop:{type:Boolean,default:!1},isClearBgColor:{type:Boolean,default:!0},format:{type:String,default:"image/png"},quality:{type:Number,default:1}},data:()=>({hasDrew:!1,resultImg:"",points:[],canvasTxt:null,startX:0,startY:0,isDrawing:!1,sratio:1}),computed:{ratio(){return this.height/this.width},stageInfo(){return this.$refs.canvas.getBoundingClientRect()},myBg(){return this.bgColor?this.bgColor:"rgba(255, 255, 255, 0)"}},watch:{myBg:function(t){this.$refs.canvas.style.background=t}},beforeMount(){window.addEventListener("resize",this.$_resizeHandler)},beforeDestroy(){window.removeEventListener("resize",this.$_resizeHandler)},mounted(){const t=this.$refs.canvas;t.height=this.height,t.width=this.width,t.style.background=this.myBg,this.$_resizeHandler(),document.onmouseup=()=>{this.isDrawing=!1}},methods:{$_resizeHandler(){const t=this.$refs.canvas;t.style.width=this.width+"px";const e=parseFloat(window.getComputedStyle(t).width);t.style.height=this.ratio*e+"px",this.canvasTxt=t.getContext("2d"),this.canvasTxt.scale(1*this.sratio,1*this.sratio),this.sratio=e/this.width,this.canvasTxt.scale(1/this.sratio,1/this.sratio)},mouseDown(t){(t=t||event).preventDefault(),this.isDrawing=!0,this.hasDrew=!0;let e={x:t.offsetX,y:t.offsetY};this.drawStart(e)},mouseMove(t){if((t=t||event).preventDefault(),this.isDrawing){let e={x:t.offsetX,y:t.offsetY};this.drawMove(e)}},mouseUp(t){(t=t||event).preventDefault();let e={x:t.offsetX,y:t.offsetY};this.drawEnd(e),this.isDrawing=!1},touchStart(t){if((t=t||event).preventDefault(),this.hasDrew=!0,1===t.touches.length){let e={x:t.targetTouches[0].clientX-this.$refs.canvas.getBoundingClientRect().left,y:t.targetTouches[0].clientY-this.$refs.canvas.getBoundingClientRect().top};this.drawStart(e)}},touchMove(t){if((t=t||event).preventDefault(),1===t.touches.length){let e={x:t.targetTouches[0].clientX-this.$refs.canvas.getBoundingClientRect().left,y:t.targetTouches[0].clientY-this.$refs.canvas.getBoundingClientRect().top};this.drawMove(e)}},touchEnd(t){if((t=t||event).preventDefault(),1===t.touches.length){let e={x:t.targetTouches[0].clientX-this.$refs.canvas.getBoundingClientRect().left,y:t.targetTouches[0].clientY-this.$refs.canvas.getBoundingClientRect().top};this.drawEnd(e)}},drawStart(t){this.startX=t.x,this.startY=t.y,this.canvasTxt.beginPath(),this.canvasTxt.moveTo(this.startX,this.startY),this.canvasTxt.lineTo(t.x,t.y),this.canvasTxt.lineCap="round",this.canvasTxt.lineJoin="round",this.canvasTxt.lineWidth=this.lineWidth*this.sratio,this.canvasTxt.stroke(),this.canvasTxt.closePath(),this.points.push(t)},drawMove(t){this.canvasTxt.beginPath(),this.canvasTxt.moveTo(this.startX,this.startY),this.canvasTxt.lineTo(t.x,t.y),this.canvasTxt.strokeStyle=this.lineColor,this.canvasTxt.lineWidth=this.lineWidth*this.sratio,this.canvasTxt.lineCap="round",this.canvasTxt.lineJoin="round",this.canvasTxt.stroke(),this.canvasTxt.closePath(),this.startY=t.y,this.startX=t.x,this.points.push(t)},drawEnd(t){this.canvasTxt.beginPath(),this.canvasTxt.moveTo(this.startX,this.startY),this.canvasTxt.lineTo(t.x,t.y),this.canvasTxt.lineCap="round",this.canvasTxt.lineJoin="round",this.canvasTxt.stroke(),this.canvasTxt.closePath(),this.points.push(t),this.points.push({x:-1,y:-1})},generate(t){let e=t&&t.format?t.format:this.format,s=t&&t.quality?t.quality:this.quality;return new Promise(((t,a)=>{if(this.hasDrew){var i=this.canvasTxt.getImageData(0,0,this.$refs.canvas.width,this.$refs.canvas.height);this.canvasTxt.globalCompositeOperation="destination-over",this.canvasTxt.fillStyle=this.myBg,this.canvasTxt.fillRect(0,0,this.$refs.canvas.width,this.$refs.canvas.height),this.resultImg=this.$refs.canvas.toDataURL(e,s);var n=this.resultImg;if(this.canvasTxt.clearRect(0,0,this.$refs.canvas.width,this.$refs.canvas.height),this.canvasTxt.putImageData(i,0,0),this.canvasTxt.globalCompositeOperation="source-over",this.isCrop){const t=this.getCropArea(i.data);var o=document.createElement("canvas");const a=o.getContext("2d");o.width=t[2]-t[0],o.height=t[3]-t[1];const h=this.canvasTxt.getImageData(...t);a.globalCompositeOperation="destination-over",a.putImageData(h,0,0),a.fillStyle=this.myBg,a.fillRect(0,0,o.width,o.height),n=o.toDataURL(e,s),o=null}t(n)}else a("Warning: Not Signned!")}))},reset(){this.canvasTxt.clearRect(0,0,this.$refs.canvas.width,this.$refs.canvas.height),this.isClearBgColor&&(this.$emit("update:bgColor",""),this.$refs.canvas.style.background="rgba(255, 255, 255, 0)"),this.points=[],this.hasDrew=!1,this.resultImg=""},getCropArea(t){for(var e=this.$refs.canvas.width,s=0,a=this.$refs.canvas.height,i=0,n=0;n<this.$refs.canvas.width;n++)for(var o=0;o<this.$refs.canvas.height;o++){var h=4*(n+this.$refs.canvas.width*o);(t[h]>0||t[h+1]>0||t[h+2]||t[h+3]>0)&&(i=Math.max(o,i),s=Math.max(n,s),a=Math.min(o,a),e=Math.min(n,e))}return[++e,++a,++s,++i]}}},[["render",function(t,a,i,n,o,h){return s(),e("canvas",{ref:"canvas",onMousedown:a[0]||(a[0]=(...t)=>h.mouseDown&&h.mouseDown(...t)),onMousemove:a[1]||(a[1]=(...t)=>h.mouseMove&&h.mouseMove(...t)),onMouseup:a[2]||(a[2]=(...t)=>h.mouseUp&&h.mouseUp(...t)),onTouchstart:a[3]||(a[3]=(...t)=>h.touchStart&&h.touchStart(...t)),onTouchmove:a[4]||(a[4]=(...t)=>h.touchMove&&h.touchMove(...t)),onTouchend:a[5]||(a[5]=(...t)=>h.touchEnd&&h.touchEnd(...t))},null,544)}],["__scopeId","data-v-7d9055bc"],["__file","D:/work/html/work/work/node_modules/vue-esign/src/index.vue"]]);m.install=function(t){this.installed||(this.installed=!0,t.component("vueEsign",m))};const x=t=>(g("data-v-1e61eea8"),t=t(),f(),t),w={class:"common-pages fu-page"},T=x((()=>h("div",{class:"common-logo"},null,-1))),y=x((()=>h("h3",{class:"page-title"},[h("img",{class:"title",src:"./assets/img-13-cc44874d.png",alt:""})],-1))),b={class:"xie-box"},C={class:"esign-box"},$={class:"btn-box"},D={class:"cloud"},k={class:"layer layer-ok"},_=x((()=>h("div",{class:"iconfont icon-dui3"},null,-1))),M=x((()=>h("div",{class:"title"},"上传成功",-1)));var B=t(a({__name:"index",setup(t){const{isLoginFn:a}=i();a();const g=n("#333"),f=n(10),x=n(!1),B=n(""),S=n(null),R=()=>{S.value.reset()},X=()=>{S.value.generate().then((t=>{let e=((t,e="file")=>{let s=t.split(","),a=s[0].match(/:(.*?);/)[1],i=a.split("/")[1],n=atob(s[1]),o=n.length,h=new Uint8Array(o);for(;o--;)h[o]=n.charCodeAt(o);return new File([h],`${e}.${i}`,{type:a})})(t),s=new FormData;s.append("file",e);p("/api.php/puzzle/lucky-create",s).then((t=>{E.value=!0}))})).catch((t=>{}))};let Y=n(!1);const I=()=>{Y.value=!0},E=n(!1);return(t,a)=>{const i=o("router-link");return s(),e("div",w,[T,y,h("div",b,[h("div",{class:"rotate-box",onTouchstart:I},[h("div",C,[r(l(m),{ref_key:"esign",ref:S,width:1e3,height:1e3,isCrop:x.value,lineWidth:f.value,lineColor:g.value,bgColor:B.value,"onUpdate:bgColor":a[0]||(a[0]=t=>B.value=t)},null,8,["isCrop","lineWidth","lineColor","bgColor"])])],32)]),c(h("div",$,[h("div",{class:"reset-btn",btn:"",onClick:R},"重写"),h("div",{class:"up-btn",btn:"",onClick:X},"上传")],512),[[u,Y.value]]),c(h("div",D,null,512),[[u,E.value]]),c(h("div",k,[_,M,r(i,{to:"/speech",class:"btn layer-btn common-btn"},{default:v((()=>[d("开始活动")])),_:1})],512),[[u,E.value]])])}}}),[["__scopeId","data-v-1e61eea8"],["__file","D:/work/html/work/work/src/views/fu/index.vue"]]);export{B as default};
